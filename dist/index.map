{"version":3,"sources":["video.js","utils/throttle.js","keyboard-shortcuts.js","utils/dom.js","vendor/vendors.js","vendor/current.js","index.js"],"names":["Video","element","tagName","Error","DEFAULT_SCRUB_SECONDS","FAST_SCRUB_SECONDS","togglePlayState","paused","play","pause","fastForward","fast","setCurrentTime","getCurrentTime","getDurationToScrub","rewind","currentTime","time","throttle","f","wait","timeoutId","args","apply","setTimeout","SCRUB_THROTTLE_MS","KeyboardShortcuts","video","keysToRegister","keyEventCodeToCommand","keyup","Space","onSpaceKeyUp","keydown","ArrowLeft","onArrowLeftKeyDown","shiftKey","ArrowRight","onArrowRightKeyDown","registerKeyListeners","Object","keys","forEach","eventName","document","addEventListener","onKeyEvent","deregisterKeyListeners","removeEventListener","event","type","code","codeToCommand","includes","preventDefault","onEvent","Promise","resolve","waitForElement","selector","querySelector","observer","MutationObserver","mutations","mutation","nodes","Array","from","addedNodes","node","matches","disconnect","observe","documentElement","childList","subtree","onElementRemove","removedNodes","contains","elementSelector","matchURL","url","test","hostname","getCurrentVendor","vendors","find","v","window","location","loop","videoLoaded","keyboardShortcuts"],"mappings":"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","file":"index.map","sourceRoot":"../src","sourcesContent":["export default function Video({ element }) {\n  if (!element || !element.tagName === \"VIDEO\") {\n    throw new Error(\"video element required\");\n  }\n\n  const DEFAULT_SCRUB_SECONDS = 10;\n  const FAST_SCRUB_SECONDS = 60;\n\n  return {\n    togglePlayState,\n    fastForward,\n    rewind\n  };\n\n  function togglePlayState() {\n    if (element.paused) {\n      element.play();\n    } else {\n      element.pause();\n    }\n  }\n\n  function fastForward({ fast }) {\n    const newTime = getCurrentTime() + getDurationToScrub({ fast });\n    setCurrentTime(newTime);\n  }\n\n  function rewind({ fast }) {\n    const newTime = getCurrentTime() - getDurationToScrub({ fast });\n    setCurrentTime(newTime);\n  }\n\n  function getCurrentTime() {\n    return element.currentTime;\n  }\n\n  function setCurrentTime(time) {\n    element.currentTime = time;\n  }\n\n  function getDurationToScrub({ fast }) {\n    return fast ? FAST_SCRUB_SECONDS : DEFAULT_SCRUB_SECONDS;\n  }\n}\n","export default function throttle(f, wait) {\n  let timeoutId = null;\n  return (...args) => {\n    if (timeoutId) return;\n\n    f.apply(this, args);\n    timeoutId = setTimeout(() => {\n      timeoutId = null;\n    }, wait);\n  };\n}\n","import throttle from \"./utils/throttle\";\n\n// Prevent flooding (UI can't keep up anyway)\nconst SCRUB_THROTTLE_MS = 100;\n\nexport default function KeyboardShortcuts({ video, keysToRegister }) {\n  const keyEventCodeToCommand = {\n    keyup: {\n      Space: onSpaceKeyUp\n    },\n    keydown: {\n      ArrowLeft: throttle(onArrowLeftKeyDown, SCRUB_THROTTLE_MS),\n      ArrowRight: throttle(onArrowRightKeyDown, SCRUB_THROTTLE_MS)\n    }\n  };\n\n  return {\n    registerKeyListeners,\n    deregisterKeyListeners\n  };\n\n  function registerKeyListeners() {\n    Object.keys(keyEventCodeToCommand).forEach(eventName => {\n      document.addEventListener(eventName, onKeyEvent);\n    });\n  }\n\n  function deregisterKeyListeners() {\n    Object.keys(keyEventCodeToCommand).forEach(eventName => {\n      document.removeEventListener(eventName, onKeyEvent);\n    });\n  }\n\n  function onKeyEvent(event) {\n    const { type, code } = event;\n    const codeToCommand = keyEventCodeToCommand[type];\n    if (keysToRegister.includes(code) && code in codeToCommand) {\n      event.preventDefault();\n      codeToCommand[code](event);\n    }\n  }\n\n  function onSpaceKeyUp() {\n    video.togglePlayState();\n  }\n\n  function onArrowLeftKeyDown({ shiftKey }) {\n    video.rewind({ fast: shiftKey });\n  }\n\n  function onArrowRightKeyDown({ shiftKey }) {\n    video.fastForward({ fast: shiftKey });\n  }\n}\n","export { onEvent, waitForElement, onElementRemove };\n\nfunction onEvent(element, eventName) {\n  return new Promise(resolve => {\n    element.addEventListener(eventName, resolve);\n  });\n}\n\nfunction waitForElement(selector) {\n  return new Promise(resolve => {\n    const element = document.querySelector(selector);\n    if (element) {\n      resolve(element);\n      return;\n    }\n\n    const observer = new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        const nodes = Array.from(mutation.addedNodes);\n        for (const node of nodes) {\n          if (node.matches && node.matches(selector)) {\n            observer.disconnect();\n            resolve(node);\n          }\n        }\n      });\n    });\n    observer.observe(document.documentElement, {\n      childList: true,\n      subtree: true\n    });\n  });\n}\n\nfunction onElementRemove(element) {\n  return new Promise(resolve => {\n    const observer = new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        const nodes = Array.from(mutation.removedNodes);\n        for (const node of nodes) {\n          if (node.contains(element)) {\n            observer.disconnect();\n            resolve();\n          }\n        }\n      });\n    });\n    observer.observe(document.documentElement, {\n      childList: true,\n      subtree: true\n    });\n  });\n}\n","export default [\n  {\n    elementSelector: \"video[id$=Clpp_html5_mse_api]\",\n    keysToRegister: [\"Space\", \"ArrowLeft\", \"ArrowRight\"],\n    matchURL: url => /^.*\\.hbonordic\\.com$/.test(url.hostname)\n  },\n  {\n    elementSelector: \"video#player\",\n    keysToRegister: [\"Space\", \"ArrowLeft\", \"ArrowRight\"],\n    matchURL: url => /^.*\\.dplay\\..*$/.test(url.hostname)\n  }\n];\n","import vendors from \"./vendors\";\n\nexport default function getCurrentVendor() {\n  return vendors.find(v => v.matchURL(window.location));\n}\n","import VideoController from \"./video\";\nimport KeyboardShortcuts from \"./keyboard-shortcuts\";\nimport { onEvent, waitForElement, onElementRemove } from \"./utils/dom\";\nimport getCurrentVendor from \"./vendor/current\";\n\n(function main() {\n  loop();\n})();\n\nasync function loop() {\n  const { elementSelector, keysToRegister } = getCurrentVendor();\n  const element = await videoLoaded(elementSelector);\n  const video = VideoController({ element });\n  const keyboardShortcuts = KeyboardShortcuts({ video, keysToRegister });\n\n  keyboardShortcuts.registerKeyListeners();\n\n  // Video element is removed when loading next episode,\n  // clean up and start over again\n  await onElementRemove(element);\n  keyboardShortcuts.deregisterKeyListeners();\n  loop();\n}\n\nasync function videoLoaded(selector) {\n  const video = await waitForElement(selector);\n  await onEvent(video, \"loadedmetadata\");\n  return video;\n}\n"]}