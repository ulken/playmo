{"version":3,"sources":["video.js","utils/throttle.js","keyboard-shortcuts.js","utils/dom.js","vendor/vendors.js","vendor/current.js","index.js"],"names":["Video","element","tagName","Error","DEFAULT_SCRUB_SECONDS","FAST_SCRUB_SECONDS","isPlaying","togglePlayState","pause","play","fastForward","fast","setCurrentTime","getCurrentTime","getDurationToScrub","rewind","paused","currentTime","time","throttle","f","wait","timeoutId","args","apply","setTimeout","SCRUB_THROTTLE_MS","KeyboardShortcuts","video","keysToRegister","keyEventCodeToCommand","keyup","Space","onSpaceKeyUp","oldState","newState","keydown","ArrowLeft","onArrowLeftKeyDown","shiftKey","ArrowRight","onArrowRightKeyDown","registerKeyListeners","Object","keys","forEach","eventName","document","addEventListener","onKeyEvent","deregisterKeyListeners","removeEventListener","event","type","code","codeToCommand","includes","preventDefault","onEvent","Promise","resolve","waitForElement","selector","querySelector","observer","MutationObserver","mutations","mutation","nodes","Array","from","addedNodes","node","matches","disconnect","observe","documentElement","childList","subtree","onElementRemove","removedNodes","contains","elementSelector","matchURL","url","test","hostname","getCurrentVendor","vendors","find","v","window","location","loop","videoLoaded","keyboardShortcuts"],"mappings":"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","file":"index.map","sourceRoot":"../src","sourcesContent":["export default function Video({ element }) {\n  if (!element || !element.tagName === \"VIDEO\") {\n    throw new Error(\"video element required\");\n  }\n\n  const DEFAULT_SCRUB_SECONDS = 10;\n  const FAST_SCRUB_SECONDS = 60;\n\n  return {\n    isPlaying,\n    togglePlayState,\n    fastForward,\n    rewind\n  };\n\n  function isPlaying() {\n    return !element.paused;\n  }\n\n  function togglePlayState() {\n    if (isPlaying()) {\n      element.pause();\n    } else {\n      element.play();\n    }\n  }\n\n  function fastForward({ fast }) {\n    const newTime = getCurrentTime() + getDurationToScrub({ fast });\n    setCurrentTime(newTime);\n  }\n\n  function rewind({ fast }) {\n    const newTime = getCurrentTime() - getDurationToScrub({ fast });\n    setCurrentTime(newTime);\n  }\n\n  function getCurrentTime() {\n    return element.currentTime;\n  }\n\n  function setCurrentTime(time) {\n    element.currentTime = time;\n  }\n\n  function getDurationToScrub({ fast }) {\n    return fast ? FAST_SCRUB_SECONDS : DEFAULT_SCRUB_SECONDS;\n  }\n}\n","export default function throttle(f, wait) {\n  let timeoutId = null;\n  return (...args) => {\n    if (timeoutId) return;\n\n    f.apply(this, args);\n    timeoutId = setTimeout(() => {\n      timeoutId = null;\n    }, wait);\n  };\n}\n","import throttle from \"./utils/throttle\";\n\n// Prevent flooding (UI can't keep up anyway)\nconst SCRUB_THROTTLE_MS = 100;\n\nexport default function KeyboardShortcuts({ video, keysToRegister }) {\n  const keyEventCodeToCommand = {\n    keyup: {\n      Space: onSpaceKeyUp\n    },\n    keydown: {\n      ArrowLeft: throttle(onArrowLeftKeyDown, SCRUB_THROTTLE_MS),\n      ArrowRight: throttle(onArrowRightKeyDown, SCRUB_THROTTLE_MS)\n    }\n  };\n\n  return {\n    registerKeyListeners,\n    deregisterKeyListeners\n  };\n\n  function registerKeyListeners() {\n    Object.keys(keyEventCodeToCommand).forEach(eventName => {\n      document.addEventListener(eventName, onKeyEvent);\n    });\n  }\n\n  function deregisterKeyListeners() {\n    Object.keys(keyEventCodeToCommand).forEach(eventName => {\n      document.removeEventListener(eventName, onKeyEvent);\n    });\n  }\n\n  function onKeyEvent(event) {\n    const { type, code } = event;\n    const codeToCommand = keyEventCodeToCommand[type];\n    if (keysToRegister.includes(code) && code in codeToCommand) {\n      event.preventDefault();\n      codeToCommand[code](event);\n    }\n  }\n\n  function onSpaceKeyUp() {\n    /* Workaround: For some players (looking at you Dplay), \n      <Space> works _sometimes_ (e.g. in first rendered video element).\n       Detect and reset to not cancel out effect. */\n    const oldState = video.isPlaying();\n    video.togglePlayState();\n    const newState = video.isPlaying();\n    if (oldState === newState) {\n      video.togglePlayState();\n    }\n  }\n\n  function onArrowLeftKeyDown({ shiftKey }) {\n    video.rewind({ fast: shiftKey });\n  }\n\n  function onArrowRightKeyDown({ shiftKey }) {\n    video.fastForward({ fast: shiftKey });\n  }\n}\n","export { onEvent, waitForElement, onElementRemove };\n\nfunction onEvent(element, eventName) {\n  return new Promise(resolve => {\n    element.addEventListener(eventName, resolve);\n  });\n}\n\nfunction waitForElement(selector) {\n  return new Promise(resolve => {\n    const element = document.querySelector(selector);\n    if (element) {\n      resolve(element);\n      return;\n    }\n\n    const observer = new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        const nodes = Array.from(mutation.addedNodes);\n        for (const node of nodes) {\n          if (node.matches && node.matches(selector)) {\n            observer.disconnect();\n            resolve(node);\n          }\n        }\n      });\n    });\n    observer.observe(document.documentElement, {\n      childList: true,\n      subtree: true\n    });\n  });\n}\n\nfunction onElementRemove(element) {\n  return new Promise(resolve => {\n    const observer = new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        const nodes = Array.from(mutation.removedNodes);\n        for (const node of nodes) {\n          if (node.contains(element)) {\n            observer.disconnect();\n            resolve();\n          }\n        }\n      });\n    });\n    observer.observe(document.documentElement, {\n      childList: true,\n      subtree: true\n    });\n  });\n}\n","export default [\n  {\n    elementSelector: \"video[id$=Clpp_html5_mse_api]\",\n    keysToRegister: [\"Space\", \"ArrowLeft\", \"ArrowRight\"],\n    matchURL: url => /^.*\\.hbonordic\\.com$/.test(url.hostname)\n  },\n  {\n    elementSelector: \"video#player\",\n    keysToRegister: [\"Space\", \"ArrowLeft\", \"ArrowRight\"],\n    matchURL: url => /^.*\\.dplay\\..*$/.test(url.hostname)\n  }\n];\n","import vendors from \"./vendors\";\n\nexport default function getCurrentVendor() {\n  return vendors.find(v => v.matchURL(window.location));\n}\n","import VideoController from \"./video\";\nimport KeyboardShortcuts from \"./keyboard-shortcuts\";\nimport { onEvent, waitForElement, onElementRemove } from \"./utils/dom\";\nimport getCurrentVendor from \"./vendor/current\";\n\n(function main() {\n  loop();\n})();\n\nasync function loop() {\n  const { elementSelector, keysToRegister } = getCurrentVendor();\n  const element = await videoLoaded(elementSelector);\n  const video = VideoController({ element });\n  const keyboardShortcuts = KeyboardShortcuts({ video, keysToRegister });\n\n  keyboardShortcuts.registerKeyListeners();\n\n  /* If video element is removed when loading next episode,\n     clean up and start over again */\n  await onElementRemove(element);\n  keyboardShortcuts.deregisterKeyListeners();\n  loop();\n}\n\nasync function videoLoaded(selector) {\n  const video = await waitForElement(selector);\n  await onEvent(video, \"loadedmetadata\");\n  return video;\n}\n"]}